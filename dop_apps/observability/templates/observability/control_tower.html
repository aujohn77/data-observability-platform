{% extends "observability/base.html" %}
{% block content %}

<section class="card">
  <div class="ct-header">
    <div class="ct-header-left">
      <div class="ct-title-row">
        <strong class="ct-title">DATA OBSERVABILITY PLATFORM — MONITORING DASHBOARD</strong>
        <button
          type="button"
          class="info-btn"
          id="statusInfoBtn"
          aria-label="Show status and KPI definitions"
          aria-haspopup="dialog"
          aria-controls="statusModal"
          title="Definitions"
        >i</button>
      </div>

      <div class="ct-meta">
        <span>Status:</span>

        <span
          class="status-dot"
          style="background-color: {{ status.dot_color }};"
        ></span>

        <strong>{{ status.status|default:"—" }}</strong>

        <span class="ct-sep">|</span>

        <span>Last ingest:</span>
        <strong>{{ status.last_ingest|default:"—" }} (UTC)</strong>
      </div>
    </div>
  </div>
</section>


<div class="grid grid-1">

  <section class="card">
    <h3 class="card-title">
      PIPELINE HEALTH
      <button
        type="button"
        class="info-btn"
        id="pipelineInfoBtn"
        aria-label="Show pipeline job definitions"
        aria-haspopup="dialog"
        aria-controls="pipelineModal"
        title="Definitions"
      >i</button>
    </h3>

    <div class="table-wrap">
      <table class="table">
        <colgroup>
          <col style="width:55%;">
          <col style="width:20%;">
          <col style="width:25%;">
        </colgroup>

        <tr>
          <th>Job</th>
          <th>Status</th>
          <th>Last Run (UTC)</th>
        </tr>

        {% for r in pipeline %}
        <tr>
          <td>{{ r.job_name }}</td>
          <td>{{ r.last_status }}</td>
          <td class="nowrap">{{ r.last_run_at|default:"—" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="3">—</td></tr>
        {% endfor %}
      </table>
    </div>
  </section>

  <section class="card">
    <h3 class="card-title">
      DATA QUALITY
      <button
        type="button"
        class="info-btn"
        id="dqInfoBtn"
        aria-label="Show data quality check definitions"
        aria-haspopup="dialog"
        aria-controls="dqModal"
        title="Definitions"
      >i</button>
    </h3>

    <div class="table-wrap">
      <table class="table">
        <colgroup>
          <col style="width:55%;">
          <col style="width:20%;">
          <col style="width:25%;">
        </colgroup>

        <tr>
          <th>Check</th>
          <th>Status</th>
          <th>Last Run (UTC)</th>
        </tr>

        {% for r in dq %}
        <tr>
          <td>{{ r.check_name }}</td>
          <td>{{ r.status }}</td>
          <td class="nowrap">{{ r.last_run_at|default:"—" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="3">—</td></tr>
        {% endfor %}
      </table>
    </div>
  </section>

</div>


<div class="grid grid-2">

  <section class="card">
    <h3 class="card-title">
      ANOMALIES
      <button
        type="button"
        class="info-btn"
        id="anomalyInfoBtn"
        aria-label="Show anomaly definitions"
        aria-haspopup="dialog"
        aria-controls="anomalyModal"
        title="Definitions"
      >i</button>
    </h3>

    <div class="table-wrap">
      <table class="table">
        <tr>
          <th>Anomaly</th>
          <th>Count (24h)</th>
        </tr>
        {% for r in anomalies %}
        <tr>
          <td>{{ r.anomaly_type }}</td>
          <td>{{ r.anomalies_24h }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2">—</td></tr>
        {% endfor %}
      </table>
    </div>
  </section>

  <section class="card">
    <h3 class="card-title">INCIDENTS</h3>
    <div class="kv">Open: <strong>{{ incidents.open_count }}</strong></div>
    <div class="kv">Acknowledged: <strong>{{ incidents.acknowledged_count }}</strong></div>
    <div class="kv">Resolved (total): <strong>{{ incidents.resolved_count_total }}</strong></div>
    <div class="kv">Resolved (24h): <strong>{{ incidents.resolved_count_24h }}</strong></div>
  </section>

</div>

<!-- Modals ... unchanged -->
{% endblock %}
