{% load static %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title|default:"Observability" }}</title>
  <link rel="stylesheet" href="{% static 'observability/observability.css' %}">


  <style>
  /* Info icon */
  .info-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.25em;
    height: 1.25em;
    margin-left: .5em;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.25);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.9);
    font-size: .9em;
    line-height: 1;
    cursor: pointer;
    user-select: none;
  }
  .info-btn:hover { background: rgba(255,255,255,.10); }
  .info-btn:focus { outline: 2px solid rgba(255,255,255,.35); outline-offset: 2px; }

  /* Backdrop + modal */
  .modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.55);
    display: none;
    z-index: 1000;
  }
  .modal-backdrop.is-open { display: block; }

  .modal {
    position: fixed;
    inset: 0;
    display: none;
    z-index: 1001;
    padding: 4vh 4vw;
    overflow: auto;
  }
  .modal.is-open { display: block; }

  .modal-card {
    max-width: 52em;
    margin: 0 auto;
    background: rgba(10, 18, 28, .98);
    border: 1px solid rgba(255,255,255,.10);
    border-radius: 12px;
    box-shadow: 0 10px 35px rgba(0,0,0,.55);
    padding: 1.1em 1.1em .9em 1.1em;
  }

  .modal-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1em;
    margin-bottom: .8em;
  }
  .modal-title {
    margin: 0;
    font-size: 1.05em;
    letter-spacing: .02em;
  }
  .modal-close {
    border: 1px solid rgba(255,255,255,.22);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.9);
    padding: .35em .55em;
    border-radius: 10px;
    cursor: pointer;
  }
  .modal-close:hover { background: rgba(255,255,255,.10); }

  .defs {
    display: grid;
    grid-template-columns: 1fr;
    gap: .7em;
    margin: 0;
  }
  .def-item {
    border: 1px solid rgba(255,255,255,.08);
    background: rgba(255,255,255,.03);
    border-radius: 10px;
    padding: .75em .85em;
  }
  .def-key {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: .95em;
    margin: 0 0 .25em 0;
    color: rgba(255,255,255,.95);
  }
  .def-desc {
    margin: 0;
    color: rgba(255,255,255,.80);
    font-size: .95em;
    line-height: 1.35;
  }

  @media (min-width: 900px) {
    .defs { grid-template-columns: 1fr 1fr; }
  }
</style>

</head>

<body>
<header class="topbar">
    <nav class="nav">
      <div class="nav-left">
        <a href="/">Home</a>
        <a href="/about/">About</a>
        <a href="{% url 'observability:overview' %}">Project Overview</a>
      </div>
    </nav>
</header>

  <main class="container">
    <h1>{{ title }}</h1>
    {% block content %}{% endblock %}
  </main>


<script>
(() => {
  function openModal(modal, backdrop, btn) {
    modal.classList.add("is-open");
    backdrop.classList.add("is-open");
    modal.setAttribute("aria-hidden", "false");
    backdrop.setAttribute("aria-hidden", "false");

    // focus close button if present
    const closeBtn = modal.querySelector(".modal-close");
    if (closeBtn) closeBtn.focus();

    // remember last focused for restore
    modal.__lastFocused = btn || document.activeElement;
  }

  function closeModal(modal, backdrop) {
    if (!modal || !backdrop) return;

    modal.classList.remove("is-open");
    backdrop.classList.remove("is-open");
    modal.setAttribute("aria-hidden", "true");
    backdrop.setAttribute("aria-hidden", "true");

    const last = modal.__lastFocused;
    if (last && typeof last.focus === "function") last.focus();
  }

  function findBackdropForModalId(modalId) {
    // statusModal -> statusBackdrop, dqModal -> dqBackdrop, etc.
    return document.getElementById(modalId.replace(/Modal$/, "Backdrop"));
  }

  function findModalForBackdropId(backdropId) {
    // statusBackdrop -> statusModal
    return document.getElementById(backdropId.replace(/Backdrop$/, "Modal"));
  }

  // CAPTURE PHASE so nothing else can block the click before we see it
  document.addEventListener("click", (e) => {
    // 1) Open: any info button with aria-controls
    const infoBtn = e.target.closest("button.info-btn[aria-controls]");
    if (infoBtn) {
      e.preventDefault();
      e.stopPropagation();
      if (e.stopImmediatePropagation) e.stopImmediatePropagation();

      const modalId = infoBtn.getAttribute("aria-controls");
      const modal = document.getElementById(modalId);
      const backdrop = findBackdropForModalId(modalId);

      if (!modal || !backdrop) {
        console.warn("Modal wiring missing:", { modalId, modal, backdrop });
        return;
      }

      openModal(modal, backdrop, infoBtn);
      return;
    }

    // 2) Close: clicking the X button
    const closeBtn = e.target.closest(".modal-close");
    if (closeBtn) {
      e.preventDefault();
      e.stopPropagation();
      if (e.stopImmediatePropagation) e.stopImmediatePropagation();

      const modal = closeBtn.closest(".modal");
      const backdrop = modal ? findBackdropForModalId(modal.id) : null;
      closeModal(modal, backdrop);
      return;
    }

    // 3) Close: clicking the backdrop itself
    const backdrop = e.target.classList && e.target.classList.contains("modal-backdrop") ? e.target : null;
    if (backdrop) {
      e.preventDefault();
      e.stopPropagation();
      if (e.stopImmediatePropagation) e.stopImmediatePropagation();

      const modal = findModalForBackdropId(backdrop.id);
      closeModal(modal, backdrop);
    }
  }, true);

  // Escape closes any open modal
  document.addEventListener("keydown", (e) => {
    if (e.key !== "Escape") return;

    const openModalEl = document.querySelector(".modal.is-open");
    if (!openModalEl) return;

    const backdrop = findBackdropForModalId(openModalEl.id);
    closeModal(openModalEl, backdrop);
  });
})();
</script>






</body>
</html>
